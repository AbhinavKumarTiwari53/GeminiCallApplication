<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Gemini Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#0f0f0f] text-gray-200 h-screen flex flex-col">

<!-- HEADER -->
<header class="border-b border-gray-800 px-6 py-4 text-center font-medium">
    Gemini Chat
</header>

<!-- CHAT AREA -->
<main
        id="chat"
        class="flex-1 overflow-y-auto px-6 py-10 space-y-8 max-w-3xl mx-auto w-full"
></main>

<!-- INPUT -->
<footer class="border-t border-gray-800 px-6 py-5">
    <div class="max-w-3xl mx-auto flex gap-3 items-end">
    <textarea
            id="prompt"
            placeholder="Send a message…"
            rows="1"
            class="flex-1 resize-none bg-[#1b1b1b] border border-gray-700 rounded-xl
             px-4 py-3 text-[15px] leading-relaxed
             focus:outline-none focus:ring-1 focus:ring-gray-500"
    ></textarea>

        <button
                onclick="sendMessage()"
                class="bg-white text-black px-5 py-3 rounded-xl text-sm font-medium
             hover:bg-gray-200 transition"
        >
            Send
        </button>
    </div>
</footer>

<script>
    const chat = document.getElementById("chat");

    function addMessage(text, isUser) {
      const wrapper = document.createElement("div");
      wrapper.className = "flex " + (isUser ? "justify-end" : "justify-start");

      const bubble = document.createElement("div");
      bubble.className = isUser
        ? "max-w-[75%] bg-[#1e1e1e] border border-gray-700 rounded-2xl px-5 py-4 leading-relaxed"
        : "max-w-[75%] bg-[#171717] border border-gray-800 rounded-2xl px-5 py-4 leading-relaxed";

      bubble.textContent = text;
      wrapper.appendChild(bubble);
      chat.appendChild(wrapper);
      chat.scrollTop = chat.scrollHeight;
    }

    async function sendMessage() {
      const input = document.getElementById("prompt");
      const text = input.value.trim();
      if (!text) return;

      input.value = "";
      addMessage(text, true);

      const thinkingWrap = document.createElement("div");
      thinkingWrap.className = "flex justify-start";

      const thinking = document.createElement("div");
      thinking.className =
        "max-w-[75%] bg-[#171717] border border-gray-800 rounded-2xl px-5 py-4 italic text-gray-400";
      thinking.textContent = "Thinking…";

      thinkingWrap.appendChild(thinking);
      chat.appendChild(thinkingWrap);
      chat.scrollTop = chat.scrollHeight;

      try {
        const res = await fetch("http://localhost:8080/add-request", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ request: text })
        });

        if (!res.ok) throw new Error("Backend error");

        const data = await res.json();

        chat.removeChild(thinkingWrap);
        addMessage(data.response, false);

      } catch (err) {
        chat.removeChild(thinkingWrap);
        addMessage("No response from server.", false);
        console.error(err);
      }
    }
</script>

</body>
</html>
